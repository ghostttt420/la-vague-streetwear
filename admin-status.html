<!DOCTYPE html>
<html>
<head>
    <title>Admin Status Check</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #0f0; padding: 20px; }
        button { background: #0f0; color: #000; padding: 15px 30px; font-size: 18px; cursor: pointer; margin: 10px; }
        .result { background: #000; padding: 15px; margin: 10px 0; border: 1px solid #0f0; }
        .error { color: #f00; }
        .success { color: #0f0; }
    </style>
</head>
<body>
    <h1>üîß Admin Panel Status Check</h1>
    <p>This page tests if the admin API is working correctly.</p>
    
    <button onclick="checkOrders()">1. Check Orders API</button>
    <div id="ordersResult" class="result">Click button above...</div>
    
    <button onclick="checkStats()">2. Check Stats API</button>
    <div id="statsResult" class="result">Click button above...</div>
    
    <button onclick="createTestOrder()">3. Create Test Order</button>
    <div id="createResult" class="result">Click button above...</div>
    
    <button onclick="verifyOrders()">4. Verify Orders Show</button>
    <div id="verifyResult" class="result">Click button above...</div>

    <script>
        const API_URL = 'https://la-vague-api.onrender.com/api';
        const ADMIN_KEY = 'lavague2024';
        
        async function checkOrders() {
            const div = document.getElementById('ordersResult');
            div.innerHTML = 'Loading...';
            try {
                const res = await fetch(`${API_URL}/admin/orders?key=${ADMIN_KEY}`);
                const data = await res.json();
                if (data.success && data.orders) {
                    div.innerHTML = `<span class="success">‚úÖ Found ${data.orders.length} orders</span><br><pre>${JSON.stringify(data.orders.slice(0,2), null, 2)}</pre>`;
                } else {
                    div.innerHTML = `<span class="error">‚ùå Error: ${data.error || 'Unknown'}</span>`;
                }
            } catch (e) {
                div.innerHTML = `<span class="error">‚ùå Failed: ${e.message}</span>`;
            }
        }
        
        async function checkStats() {
            const div = document.getElementById('statsResult');
            div.innerHTML = 'Loading...';
            try {
                const res = await fetch(`${API_URL}/admin/stats?key=${ADMIN_KEY}`);
                const data = await res.json();
                if (data.success && data.stats) {
                    div.innerHTML = `<span class="success">‚úÖ Stats: ${data.stats.totalOrders} orders, $${data.stats.totalRevenue} revenue</span>`;
                } else {
                    div.innerHTML = `<span class="error">‚ùå Error: ${data.error || 'Unknown'}</span>`;
                }
            } catch (e) {
                div.innerHTML = `<span class="error">‚ùå Failed: ${e.message}</span>`;
            }
        }
        
        async function createTestOrder() {
            const div = document.getElementById('createResult');
            div.innerHTML = 'Creating...';
            try {
                const res = await fetch(`${API_URL}/orders`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        customerName: 'Test User',
                        customerEmail: 'test@example.com',
                        customerPhone: '1234567890',
                        shippingAddress: { address: '123 Test St', city: 'Test City', state: 'TS', zip: '12345' },
                        items: [{ name: 'Test Product', price: 50, quantity: 1 }],
                        subtotal: 50, shippingCost: 10, discount: 0, total: 60,
                        paymentMethod: 'test', notes: ''
                    })
                });
                const data = await res.json();
                if (data.success) {
                    div.innerHTML = `<span class="success">‚úÖ Order created: ${data.orderId}</span>`;
                } else {
                    div.innerHTML = `<span class="error">‚ùå Failed: ${data.error}</span>`;
                }
            } catch (e) {
                div.innerHTML = `<span class="error">‚ùå Failed: ${e.message}</span>`;
            }
        }
        
        async function verifyOrders() {
            const div = document.getElementById('verifyResult');
            div.innerHTML = 'Checking...';
            try {
                const res = await fetch(`${API_URL}/admin/orders?key=${ADMIN_KEY}`);
                const data = await res.json();
                if (data.success && data.orders && data.orders.length > 0) {
                    const order = data.orders[0];
                    const checks = [];
                    checks.push(order.id ? '‚úÖ Has ID' : '‚ùå Missing ID');
                    checks.push(order.customer_name ? '‚úÖ Has customer_name' : '‚ùå Missing customer_name');
                    checks.push(order.customer_email ? '‚úÖ Has customer_email' : '‚ùå Missing customer_email');
                    checks.push(order.total !== undefined ? '‚úÖ Has total' : '‚ùå Missing total');
                    checks.push(order.items ? `‚úÖ Has items (${order.items.length})` : '‚ùå Missing items');
                    checks.push(order.created_at ? '‚úÖ Has created_at' : '‚ùå Missing created_at');
                    div.innerHTML = checks.join('<br>');
                } else {
                    div.innerHTML = `<span class="error">‚ùå No orders found</span>`;
                }
            } catch (e) {
                div.innerHTML = `<span class="error">‚ùå Failed: ${e.message}</span>`;
            }
        }
        
        // Auto-run on load
        checkOrders();
    </script>
</body>
</html>
